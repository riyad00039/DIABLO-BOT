import fetch from 'node-fetch'

const handler = async (m, { conn, args }) => {
    if (args.length < 2) {
        throw `
*â•­â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*
*â†â”‡âš ï¸ ÙŠÙÙ€Ø±Ø¬Ù€Ù‰ ØªÙ€Ø­Ù€Ø¯ÙŠÙ€Ø¯ Ø§Ù„Ù€Ù„Ù€ØºÙ€Ø© Ø«Ù€Ù… Ø§Ù„Ù€Ù†Ù€Øµ â†*
*â†â”‡ğŸ“Œ Ù…Ù€Ø«Ù€Ù€Ø§Ù„: â†*
> .ØªÙ†ÙÙŠØ°_Ø§Ù„ØªØ±Ø¬Ù…Ø© en Ù…Ø±Ø­Ø¨Ø§
*â•°â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*`
    }

    const lang = args[0].toLowerCase()
    const text = args.slice(1).join(' ')
    const url = `https://api.popcat.xyz/translate?to=${lang}&text=${encodeURIComponent(text)}`

    try {
        const res = await fetch(url)
        const data = await res.json()

        if (!data.translated) {
            throw `
*â•­â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*
*â†â”‡âŒ ÙÙ€Ø´Ù€Ù„ ÙÙ€ÙŠ Ø§Ù„Ù€ØªÙ€Ø±Ø¬Ù€Ù…Ù€Ø©! â†*
*â†â”‡ğŸ”¤ ØªÙ€Ø£ÙƒÙ€Ø¯ Ù…Ù€Ù† Ø¥Ø¯Ø®Ù€Ø§Ù„ Ù„Ù€ØºÙ€Ø© Ù…Ù€Ø¯Ø¹Ù€ÙˆÙ…Ù€Ø© â†*
*â•°â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*`
        }

        const reply = `
*â•­â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*
*â†â”‡ğŸŒ Ø§Ù„Ù€Ù„Ù€ØºÙ€Ø©:* ${lang.toUpperCase()} â†*
*â†â”‡ğŸ“– Ø§Ù„Ù€ØªÙ€Ø±Ø¬Ù€Ù…Ù€Ø©:* ${data.translated} â†*
*â•°â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*`

        await conn.sendMessage(m.chat, { text: reply }, { quoted: m })

    } catch (error) {
        const errMsg = `
*â•­â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*
*â†â”‡âš ï¸ Ø­Ù€Ø¯Ø« Ø®Ù€Ø·Ù€Ø£ Ø£Ø«Ù€Ù†Ù€Ø§Ø¡ Ø§Ù„Ù€ØªÙ€Ø±Ø¬Ù€Ù…Ù€Ø©! â†*
*â†â”‡ğŸ” Ø§Ù„Ù€ØªÙ€ÙÙ€Ø§ØµÙ€ÙŠÙ€Ù„:* ${error.message} â†*
*â•°â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*`
        await conn.sendMessage(m.chat, { text: errMsg }, { quoted: m })
    }
}

handler.command = /^ØªÙ†ÙÙŠØ°_Ø§Ù„ØªØ±Ø¬Ù…Ø©$/i
export default handler