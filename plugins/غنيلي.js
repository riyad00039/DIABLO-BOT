//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•//
//     ğŸ§ AI MUSIC GENERATOR ğŸ¶
//        Developed by TYSON
//â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•//

import fetch from "node-fetch";

const handler = async (m, { conn, text, usedPrefix, command }) => {
  try {
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€//
    // ğŸŸ¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€//
    if (!text)
      return m.reply(
        `*â•­â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*\n` +
        `*â†â”‡Ø§Ù„Ù€Ø­Ù€Ø§Ù„Ù€Ø©ğŸš«â†:* Ø®Ù€Ø·Ù€Ø£ ÙÙ€ÙŠ Ø§Ù„Ø¥Ø¯Ø®Ù€Ø§Ù„ âŒ\n` +
        `*â†â”‡Ø§Ù„Ù€Ø±Ø³Ù€Ø§Ù„Ù€Ø©ğŸ“©â†:* Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ø£ØºÙ†ÙŠØ© Ø£Ùˆ Ø§Ù„Ø¬Ù…Ù„Ø© ğŸµ\n` +
        `*â†â”‡Ù…Ù€Ø«Ù€Ø§Ù„ğŸ§â†:* \`${usedPrefix + command} sad cat\`\n` +
        `*â•°â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*`
      );

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€//
    // ğŸ• Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€//
    const waitMsg = await conn.sendMessage(
      m.chat,
      {
        text:
          `*â•­â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*\n` +
          `*â†â”‡Ø§Ù„Ù€Ø­Ù€Ø§Ù„Ù€Ø©ğŸ¶â†:* Ø¬Ù€Ø§Ø±ÙŠ Ø¥ÙØ¹Ù€Ø¯Ø§Ø¯ Ø£ØºÙ€Ù†Ù€ÙŠÙ€ØªÙ€Ùƒ ... ğŸ§\n` +
          `*â†â”‡Ø§Ù„Ù€Ø±Ø¬Ù€Ø§Ø¡âŒ›â†:* Ø§Ù†Ù€ØªÙ€Ø¸Ù€Ø± Ù‚Ù€Ù„Ù€ÙŠÙ€Ù„Ù‹Ø§ØŒ ÙŠÙ€ØªÙ€Ù… ØªÙ€ÙˆÙ„Ù€ÙŠÙ€Ø¯ Ø§Ù„Ù€ÙƒÙ€Ù„Ù€Ù…Ù€Ø§Øª ÙˆØ§Ù„Ù€Ù„Ù€Ø­Ù€Ù† ğŸµ\n` +
          `*â•°â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*`,
      },
      { quoted: m }
    );

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€//
    // ğŸ”µ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€//
    const prompt = encodeURIComponent(text);
    const api = `https://api-tyson-md.vercel.app/api/ai/suno?prompt=${prompt}`;
    let res = await fetch(api);
    let data = await res.json();

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€//
    // ğŸ”´ ÙØ´Ù„ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£ØºÙ†ÙŠØ©
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€//
    if (!data?.status || !data?.song?.url) {
      return conn.sendMessage(
        m.chat,
        {
          text:
            `*â•­â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*\n` +
            `*â†â”‡Ø§Ù„Ù€Ø­Ù€Ø§Ù„Ù€Ø©âŒâ†:* ÙÙ€Ø´Ù€Ù„ ØªÙ€ÙˆÙ„Ù€ÙŠÙ€Ø¯ Ø§Ù„Ø£ØºÙ€Ù†Ù€ÙŠÙ€Ø©\n` +
            `*â†â”‡Ø§Ù„Ù€Ø±Ø³Ù€Ø§Ù„Ù€Ø©ğŸ“©â†:* Ø­Ø¯Ø« Ø®Ù€Ø·Ù€Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ØŒ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§ ğŸ”\n` +
            `*â•°â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*`,
        },
        { quoted: m }
      );
    }

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€//
    // ğŸŸ¢ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØºÙ†ÙŠØ© ÙˆÙ†ØªÙŠØ¬ØªÙ‡Ø§
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€//
    const { name, url, thumbnail } = data.song;

    // ğŸµ Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
    await conn.sendMessage(
      m.chat,
      {
        image: { url: thumbnail },
        caption:
          `*â•®â”€â”€â”€â”€ğŸ¶Ø±ÙŠÙ€Ù€Ù€Ø²Ùˆ Ù…ÙŠÙˆØ²ÙŠÙƒğŸ¶â”€â”€â”€âŸ¢Ù€*\n` +
          `*â†â”‡Ø§Ù„Ù€Ù†Ù€ØªÙ€ÙŠÙ€Ø¬Ù€Ø©ğŸ¶â†:* ØªÙ€Ù… ØªÙ€ÙˆÙ„Ù€ÙŠÙ€Ø¯ Ø£ØºÙ€Ù†Ù€ÙŠÙ€ØªÙ€Ùƒ Ø¨Ù€Ù†Ù€Ø¬Ù€Ø§Ø­ ğŸ§\n` +
          `*â†â”‡Ø§Ù„Ø§Ø³Ù€Ù…ğŸ’¿â†:* *"${name}"*\n` +
          `*â†â”‡Ø§Ù„Ù€Ø±Ø§Ø¨Ù€Ø·ğŸ”—â†:* (${url})\n` +
          `*â•°â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*\n\n` +
          `> ğŸ§ *ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØ§Ø³Ø·Ø©* á–‡Yá˜”O á—·OT âš¡`,
      },
      { quoted: waitMsg }
    );

    // ğŸ§ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØª Ù†ÙØ³Ù‡
    await conn.sendMessage(
      m.chat,
      {
        audio: { url },
        mimetype: "audio/mpeg",
        fileName: `${name}.mp3`,
        ptt: false,
      },
      { quoted: m }
    );
  } catch (err) {
    console.error(err);
    await conn.sendMessage(
      m.chat,
      {
        text:
          `*â•­â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*\n` +
          `*â†â”‡Ø§Ù„Ù€Ø­Ù€Ø§Ù„Ù€Ø©âš ï¸â†:* Ø®Ù€Ø·Ù€Ø£ ØºÙ€ÙŠÙ€Ø± Ù…Ù€ØªÙ€ÙˆÙ‚Ù€Ø¹ ğŸ§©\n` +
          `*â†â”‡Ø§Ù„Ù€Ø±Ø³Ù€Ø§Ù„Ù€Ø©ğŸ“©â†:* Ø¬Ø±Ø¨ Ø¨Ø¹Ø¯ Ø¯Ù‚Ø§Ø¦Ù‚ Ù‚Ù„ÙŠÙ„Ø© ğŸ”\n` +
          `*â•°â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâŸ*`,
      },
      { quoted: m }
    );
  }
};

handler.command = ["ØºÙ†ÙŠÙ„ÙŠ", "Ø§ØºÙ†ÙŠØªÙŠ", "aiØºÙ†ÙŠ"];
handler.help = ["ØºÙ†ÙŠÙ„ÙŠ"];
handler.tags = ["ai", "music"];

export default handler;